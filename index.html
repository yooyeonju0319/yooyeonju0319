<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PhotoGallery (통합 버전)</title>

    <!-- React 및 Babel CDN 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts 로드 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Noto Sans KR", sans-serif;
      }
      .dark-placeholder::placeholder {
        color: #9ca3af; /* Tailwind gray-400 */
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // ===== 데이터베이스 시뮬레이션 (LocalStorage) =====
      const db = {
        getUsers: () =>
          JSON.parse(localStorage.getItem("pg_users_standalone")) || [],
        saveUsers: (users) =>
          localStorage.setItem("pg_users_standalone", JSON.stringify(users)),
        getPhotos: () =>
          JSON.parse(localStorage.getItem("pg_photos_standalone")) || [],
        savePhotos: (photos) =>
          localStorage.setItem("pg_photos_standalone", JSON.stringify(photos)),
        getLoggedInUser: () => {
          const userJson = localStorage.getItem("pg_loggedInUser_standalone");
          return userJson ? JSON.parse(userJson) : null;
        },
        setLoggedInUser: (user) =>
          localStorage.setItem(
            "pg_loggedInUser_standalone",
            JSON.stringify(user)
          ),
        logout: () => localStorage.removeItem("pg_loggedInUser_standalone"),
      };

      // ===== 유틸리티 함수 =====
      function showToast(message, duration = 3000) {
        const toastContainer = document.getElementById("toast-container");
        if (!toastContainer) return;

        const toast = document.createElement("div");
        toast.className =
          "bg-gray-200 text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-xl transition-all duration-300 transform translate-y-5 opacity-0";
        toast.textContent = message;
        toastContainer.appendChild(toast);

        setTimeout(() => {
          toast.classList.remove("translate-y-5", "opacity-0");
        }, 10);

        setTimeout(() => {
          toast.classList.add("opacity-0");
          toast.addEventListener("transitionend", () => toast.remove());
        }, duration);
      }

      // ===== 아이콘 컴포넌트 =====
      const StarIcon = ({ isFilled, onClick }) => (
        <svg
          onClick={onClick}
          className={`w-6 h-6 cursor-pointer ${
            isFilled ? "text-yellow-400" : "text-gray-500 hover:text-yellow-300"
          }`}
          fill={isFilled ? "currentColor" : "none"}
          viewBox="0 0 24 24"
          stroke="currentColor"
          strokeWidth="2"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
          />
        </svg>
      );

      const UploadIcon = ({ onClick }) => (
        <svg
          onClick={onClick}
          className="w-8 h-8"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          strokeWidth="2"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      );

      // ===== 메인 앱 컴포넌트 =====
      function App() {
        const [page, setPage] = useState("home");
        const [currentUser, setCurrentUser] = useState(db.getLoggedInUser());
        const [photos, setPhotos] = useState(db.getPhotos());
        const [viewingProfile, setViewingProfile] = useState(null);

        const navigate = (targetPage, params = null) => {
          if (targetPage === "profile") {
            // '내 프로필' 클릭 시 params가 없으므로 null로 설정
            setViewingProfile(params ? params.username : null);
          }
          setPage(targetPage);
          window.location.hash = targetPage;
        };

        const refreshData = () => {
          setPhotos(db.getPhotos());
          setCurrentUser(db.getLoggedInUser());
        };

        useEffect(() => {
          const handleHashChange = () => {
            const hash = window.location.hash.replace("#", "");
            const newPage = hash || "home";
            if (newPage !== "profile") {
              setViewingProfile(null);
            }
            setPage(newPage);
          };
          window.addEventListener("hashchange", handleHashChange);
          handleHashChange();
          return () =>
            window.removeEventListener("hashchange", handleHashChange);
        }, []);

        const handleLogout = () => {
          db.logout();
          setCurrentUser(null);
          navigate("home");
          showToast("로그아웃되었습니다.");
        };

        const handleLike = (photoId) => {
          if (!currentUser) {
            showToast("공감하려면 로그인이 필요합니다.");
            navigate("login");
            return;
          }
          const allPhotos = db.getPhotos();
          const photoIndex = allPhotos.findIndex((p) => p.id === photoId);
          if (photoIndex === -1) return;

          const photo = allPhotos[photoIndex];
          photo.likes = photo.likes || [];
          const likeIndex = photo.likes.indexOf(currentUser.username);

          if (likeIndex > -1) {
            photo.likes.splice(likeIndex, 1);
          } else {
            photo.likes.push(currentUser.username);
          }
          db.savePhotos(allPhotos);
          refreshData();
        };

        const renderPage = () => {
          switch (page) {
            case "login":
              return (
                <LoginPage
                  setCurrentUser={setCurrentUser}
                  navigate={navigate}
                />
              );
            case "signup":
              return <SignupPage navigate={navigate} />;
            case "profile":
              return (
                <ProfilePage
                  currentUser={currentUser}
                  profileUsername={
                    viewingProfile ||
                    (currentUser ? currentUser.username : null)
                  }
                  photos={photos}
                  onUpdateUser={refreshData}
                  onLike={handleLike}
                  navigate={navigate}
                />
              );
            case "upload":
              return (
                <UploadPage
                  currentUser={currentUser}
                  navigate={navigate}
                  onUploadSuccess={refreshData}
                />
              );
            case "home":
            default:
              return (
                <HomePage
                  photos={photos}
                  onLike={handleLike}
                  onViewProfile={(username) =>
                    navigate("profile", { username })
                  }
                  navigate={navigate}
                />
              );
          }
        };

        return (
          <div className="min-h-screen">
            <Header
              currentUser={currentUser}
              onLogout={handleLogout}
              navigate={navigate}
            />
            <main className="container mx-auto p-6">{renderPage()}</main>
            <div
              id="toast-container"
              className="fixed bottom-10 right-10 space-y-2 z-50"
            ></div>
          </div>
        );
      }

      // ===== 컴포넌트들 =====
      const Header = ({ currentUser, onLogout, navigate }) => (
        <header className="bg-gray-800 shadow-lg sticky top-0 z-40">
          <nav className="container mx-auto px-6 py-3 flex justify-between items-center">
            <a
              href="#home"
              onClick={(e) => {
                e.preventDefault();
                navigate("home");
              }}
              className="text-2xl font-bold text-pink-500 tracking-wider"
              style={{ fontFamily: "monospace" }}
            >
              lechabo
            </a>
            <div className="flex items-center space-x-5">
              {currentUser ? (
                <>
                  <a
                    href="#upload"
                    onClick={(e) => {
                      e.preventDefault();
                      navigate("upload");
                    }}
                    className="text-gray-300 hover:text-pink-400 transition"
                  >
                    사진 올리기
                  </a>
                  <a
                    href="#profile"
                    onClick={(e) => {
                      e.preventDefault();
                      navigate("profile");
                    }}
                    className="text-gray-300 hover:text-pink-400 transition"
                  >
                    내 프로필
                  </a>
                  <button
                    onClick={onLogout}
                    className="text-gray-300 hover:text-red-500 transition"
                  >
                    로그아웃
                  </button>
                </>
              ) : (
                <>
                  <a
                    href="#login"
                    onClick={(e) => {
                      e.preventDefault();
                      navigate("login");
                    }}
                    className="text-gray-300 hover:text-pink-400 transition"
                  >
                    로그인
                  </a>
                  <a
                    href="#signup"
                    onClick={(e) => {
                      e.preventDefault();
                      navigate("signup");
                    }}
                    className="bg-pink-500 text-white px-4 py-2 rounded-md hover:bg-pink-600 transition"
                  >
                    회원가입
                  </a>
                </>
              )}
            </div>
          </nav>
        </header>
      );

      const HomePage = ({ photos, onLike, onViewProfile, navigate }) => {
        const [searchQuery, setSearchQuery] = useState("");
        const [searchResults, setSearchResults] = useState([]);
        const [carouselIndex, setCarouselIndex] = useState(0);
        const currentUser = db.getLoggedInUser();

        useEffect(() => {
          if (photos.length > 1 && searchQuery === "") {
            const timer = setInterval(() => {
              setCarouselIndex((prevIndex) => (prevIndex + 1) % photos.length);
            }, 4000);
            return () => clearInterval(timer);
          }
        }, [photos.length, searchQuery]);

        const handleSearch = (e) => {
          const query = e.target.value.toLowerCase();
          setSearchQuery(query);
          if (!query) {
            setSearchResults([]);
            return;
          }
          const results = photos.filter(
            (p) =>
              p.title.toLowerCase().includes(query) ||
              (p.tags &&
                p.tags.some((tag) => tag.toLowerCase().includes(query)))
          );
          setSearchResults(results);
        };

        const currentCarouselPhoto = photos[carouselIndex];

        return (
          <div className="relative min-h-[80vh]">
            <div className="mb-8">
              <input
                type="search"
                value={searchQuery}
                onChange={handleSearch}
                placeholder="제목이나 태그로 검색하세요..."
                className="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:border-pink-500 focus:ring-pink-500 transition dark-placeholder"
              />
            </div>

            {searchQuery ? (
              <div>
                <h2 className="text-2xl font-bold mb-6 text-white">
                  검색 결과
                </h2>
                {searchResults.length > 0 ? (
                  <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    {searchResults.map((photo) => (
                      <div
                        key={photo.id}
                        onDoubleClick={() => onLike(photo.id)}
                        onContextMenu={(e) => {
                          e.preventDefault();
                          onViewProfile(photo.uploader);
                        }}
                        className="bg-gray-800 rounded-lg shadow-lg overflow-hidden group cursor-pointer"
                      >
                        <img
                          src={photo.url}
                          alt={photo.title}
                          className="w-full h-48 object-cover pointer-events-none"
                        />
                        <div className="p-4 flex justify-between items-center">
                          <div>
                            <h4 className="text-white font-semibold truncate">
                              {photo.title}
                            </h4>
                            <p className="text-sm text-gray-400">
                              by {photo.uploader}
                            </p>
                          </div>
                          <div className="flex items-center gap-1 text-yellow-400">
                            <span>{photo.likes ? photo.likes.length : 0}</span>
                            <StarIcon isFilled={true} />
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <p className="text-center text-gray-500 py-10">
                    검색 결과가 없습니다.
                  </p>
                )}
              </div>
            ) : photos.length > 0 ? (
              <div
                className="relative w-full max-w-4xl mx-auto bg-black rounded-lg shadow-xl overflow-hidden cursor-pointer"
                style={{ height: "60vh" }}
                onDoubleClick={() => onLike(currentCarouselPhoto.id)}
                onContextMenu={(e) => {
                  e.preventDefault();
                  onViewProfile(currentCarouselPhoto.uploader);
                }}
              >
                {photos.map((photo, index) => (
                  <div
                    key={photo.id}
                    className={`absolute w-full h-full transition-opacity duration-1000 ${
                      index === carouselIndex ? "opacity-100" : "opacity-0"
                    }`}
                  >
                    <img
                      src={photo.url}
                      alt={photo.title}
                      className="w-full h-full object-cover"
                    />
                    <div className="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-black to-transparent">
                      <h3 className="text-white text-3xl font-bold">
                        {photo.title}
                      </h3>
                      <p className="text-gray-300">{photo.tags.join(", ")}</p>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-20">
                <h2 className="text-3xl font-semibold text-gray-500 mb-4">
                  아직 업로드된 사진이 없습니다.
                </h2>
                <p className="text-gray-500 mb-8">
                  당신의 멋진 순간을 공유해보세요!
                </p>
                <a
                  href="#upload"
                  onClick={(e) => {
                    e.preventDefault();
                    navigate("upload");
                  }}
                  className="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105"
                >
                  첫 사진 업로드하기
                </a>
              </div>
            )}

            {currentUser && (
              <button
                onClick={() => navigate("upload")}
                className="fixed bottom-8 right-8 bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-110 z-30"
              >
                <UploadIcon />
              </button>
            )}
          </div>
        );
      };

      const AuthForm = ({
        title,
        onSubmit,
        buttonText,
        switchText,
        switchLink,
        switchLinkText,
        navigate,
        confirmPassword = false,
      }) => (
        <div className="max-w-md mx-auto bg-gray-800 p-8 mt-10 rounded-xl shadow-lg">
          <h2 className="text-3xl font-bold text-center mb-8 text-white">
            {title}
          </h2>
          <form onSubmit={onSubmit}>
            <div className="mb-4">
              <label className="block text-gray-300 text-sm font-bold mb-2">
                아이디
              </label>
              <input
                type="text"
                name="username"
                className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white dark-placeholder"
                required
              />
            </div>
            <div className="mb-6">
              <label className="block text-gray-300 text-sm font-bold mb-2">
                비밀번호
              </label>
              <input
                type="password"
                name="password"
                className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white"
                required
              />
            </div>
            {confirmPassword && (
              <div className="mb-6">
                <label className="block text-gray-300 text-sm font-bold mb-2">
                  비밀번호 확인
                </label>
                <input
                  type="password"
                  name="confirmPassword"
                  className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white"
                  required
                />
              </div>
            )}
            <button
              type="submit"
              className="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg transition"
            >
              {buttonText}
            </button>
          </form>
          <p className="text-center mt-6 text-gray-400">
            {switchText}
            <a
              href={switchLink}
              onClick={(e) => {
                e.preventDefault();
                navigate(switchLink.substring(1));
              }}
              className="text-pink-400 hover:underline"
            >
              {switchLinkText}
            </a>
          </p>
        </div>
      );

      const LoginPage = ({ setCurrentUser, navigate }) => {
        const handleSubmit = (e) => {
          e.preventDefault();
          const username = e.target.username.value;
          const password = e.target.password.value;
          const users = db.getUsers();
          const user = users.find(
            (u) => u.username === username && u.password === password
          );

          if (user) {
            db.setLoggedInUser(user);
            setCurrentUser(user);
            navigate("home");
            showToast(`${username}님, 환영합니다!`);
          } else {
            showToast("아이디 또는 비밀번호가 올바르지 않습니다.");
          }
        };
        return (
          <AuthForm
            title="로그인"
            onSubmit={handleSubmit}
            buttonText="로그인"
            switchText="계정이 없으신가요?"
            switchLink="#signup"
            switchLinkText="회원가입"
            navigate={navigate}
          />
        );
      };

      const SignupPage = ({ navigate }) => {
        const handleSubmit = (e) => {
          e.preventDefault();
          const username = e.target.username.value;
          const password = e.target.password.value;
          const confirmPassword = e.target.confirmPassword.value;

          if (password !== confirmPassword) {
            showToast("비밀번호가 일치하지 않습니다.");
            return;
          }
          const users = db.getUsers();
          if (users.find((u) => u.username === username)) {
            showToast("이미 존재하는 아이디입니다.");
            return;
          }

          const defaultProfilePic = `https://placehold.co/192x192/EFEFEF/3A3A3A?text=${username.charAt(
            0
          )}`;
          users.push({ username, password, profilePic: defaultProfilePic });
          db.saveUsers(users);
          showToast("회원가입 성공! 로그인해주세요.");
          navigate("login");
        };
        return (
          <AuthForm
            title="회원가입"
            onSubmit={handleSubmit}
            buttonText="가입하기"
            switchText="이미 계정이 있으신가요?"
            switchLink="#login"
            switchLinkText="로그인"
            navigate={navigate}
            confirmPassword
          />
        );
      };

      const ProfilePage = ({
        currentUser,
        profileUsername,
        photos,
        onUpdateUser,
        onLike,
        navigate,
      }) => {
        const [isEditing, setIsEditing] = useState(false);
        const [newUsername, setNewUsername] = useState(profileUsername || "");

        const users = db.getUsers();
        const profileUser = users.find((u) => u.username === profileUsername);

        useEffect(() => {
          if (!profileUsername) {
            navigate("home");
          } else {
            setNewUsername(profileUsername);
          }
        }, [profileUsername, navigate]);

        const handleFileChange = (e) => {
          if (e.target.files && e.target.files[0] && currentUser) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
              const newPicDataUrl = event.target.result;
              const allUsers = db.getUsers();
              const userIndex = allUsers.findIndex(
                (u) => u.username === currentUser.username
              );
              if (userIndex > -1) {
                allUsers[userIndex].profilePic = newPicDataUrl;
                db.saveUsers(allUsers);
                db.setLoggedInUser(allUsers[userIndex]);
                onUpdateUser();
                showToast("프로필 사진이 변경되었습니다.");
              }
            };
            reader.readAsDataURL(file);
          }
        };

        const handleSaveUsername = () => {
          if (!newUsername.trim()) {
            showToast("이름을 입력해주세요.");
            return;
          }
          const oldUsername = currentUser.username;
          if (oldUsername === newUsername) {
            setIsEditing(false);
            return;
          }
          const allUsers = db.getUsers();
          if (allUsers.some((u) => u.username === newUsername)) {
            showToast("이미 사용 중인 이름입니다.");
            return;
          }

          const userIndex = allUsers.findIndex(
            (u) => u.username === oldUsername
          );
          allUsers[userIndex].username = newUsername;
          db.saveUsers(allUsers);

          const allPhotos = db.getPhotos();
          const updatedPhotos = allPhotos.map((p) => {
            const newLikes = p.likes
              ? p.likes.map((like) =>
                  like === oldUsername ? newUsername : like
                )
              : [];
            if (p.uploader === oldUsername) {
              return { ...p, uploader: newUsername, likes: newLikes };
            }
            return { ...p, likes: newLikes };
          });
          db.savePhotos(updatedPhotos);

          db.setLoggedInUser(allUsers[userIndex]);
          onUpdateUser();
          setIsEditing(false);
          showToast("이름이 변경되었습니다.");
        };

        if (!profileUser) {
          return (
            <div className="text-center text-gray-500 py-10">
              사용자를 찾을 수 없습니다.
            </div>
          );
        }

        const isMyProfile =
          currentUser && currentUser.username === profileUser.username;
        const userPhotos = photos.filter(
          (p) => p.uploader === profileUser.username
        );

        return (
          <div className="max-w-4xl mx-auto">
            <div className="bg-gray-800 p-8 mb-8 rounded-xl shadow-lg text-center">
              <div
                onContextMenu={
                  isMyProfile
                    ? (e) => {
                        e.preventDefault();
                        document
                          .getElementById("profile-upload-input")
                          ?.click();
                      }
                    : null
                }
                className={`relative w-48 h-48 mx-auto mb-4 group ${
                  isMyProfile ? "cursor-pointer" : ""
                }`}
              >
                <img
                  src={profileUser.profilePic}
                  alt="프로필 이미지"
                  className="w-full h-full rounded-full object-cover border-4 border-gray-600"
                />
                {isMyProfile && (
                  <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                    <p className="text-white text-sm font-bold">
                      우클릭하여
                      <br />
                      사진 업로드
                    </p>
                  </div>
                )}
              </div>
              {isMyProfile && (
                <input
                  type="file"
                  id="profile-upload-input"
                  onChange={handleFileChange}
                  className="hidden"
                  accept="image/*"
                />
              )}

              {!isEditing ? (
                <div className="flex justify-center items-center gap-4">
                  <h3 className="text-2xl font-semibold text-white">
                    {profileUser.username}
                  </h3>
                  {isMyProfile && (
                    <button
                      onClick={() => setIsEditing(true)}
                      className="text-sm text-pink-400 hover:underline"
                    >
                      수정
                    </button>
                  )}
                </div>
              ) : (
                <div className="flex justify-center items-center gap-2">
                  <input
                    type="text"
                    value={newUsername}
                    onChange={(e) => setNewUsername(e.target.value)}
                    className="p-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-center"
                  />
                  <button
                    onClick={handleSaveUsername}
                    className="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm"
                  >
                    저장
                  </button>
                  <button
                    onClick={() => setIsEditing(false)}
                    className="bg-gray-600 hover:bg-gray-500 text-white px-3 py-2 rounded-lg text-sm"
                  >
                    취소
                  </button>
                </div>
              )}
            </div>

            <h2 className="text-2xl font-bold mb-6 text-white border-b border-gray-700 pb-2">
              {isMyProfile
                ? "내가 올린 사진"
                : `${profileUser.username}님의 사진`}
            </h2>
            {userPhotos.length > 0 ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                {userPhotos.map((photo) => (
                  <div
                    key={photo.id}
                    className="bg-gray-800 rounded-lg shadow-lg overflow-hidden group"
                  >
                    <img
                      src={photo.url}
                      alt={photo.title}
                      className="w-full h-48 object-cover"
                    />
                    <div className="p-4 flex justify-between items-center">
                      <h4 className="text-white font-semibold truncate">
                        {photo.title}
                      </h4>
                      <div className="flex items-center gap-2">
                        <span className="text-sm text-yellow-400">
                          {photo.likes ? photo.likes.length : 0}
                        </span>
                        <StarIcon
                          isFilled={
                            currentUser &&
                            photo.likes &&
                            photo.likes.includes(currentUser.username)
                          }
                          onClick={() => onLike(photo.id)}
                        />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <p className="text-center text-gray-500 py-10">
                아직 업로드한 사진이 없습니다.
              </p>
            )}
          </div>
        );
      };

      const UploadPage = ({ currentUser, navigate, onUploadSuccess }) => {
        useEffect(() => {
          if (!currentUser) navigate("login");
        }, [currentUser, navigate]);

        const handleSubmit = (e) => {
          e.preventDefault();
          const title = e.target.title.value;
          const tags = e.target.tags.value;
          const description = e.target.description.value;
          const file = e.target.photo.files[0];

          if (!file) {
            showToast("이미지 파일을 선택해주세요.");
            return;
          }

          const reader = new FileReader();
          reader.onload = (event) => {
            const photos = db.getPhotos();
            const newPhoto = {
              id: Date.now(),
              uploader: currentUser.username,
              url: event.target.result,
              title,
              tags: tags ? tags.split(",").map((t) => t.trim()) : [],
              description,
              likes: [],
            };
            photos.unshift(newPhoto);
            db.savePhotos(photos);
            showToast("사진이 성공적으로 업로드되었습니다!");
            onUploadSuccess();
            navigate("home");
          };
          reader.readAsDataURL(file);
        };

        if (!currentUser) return null;

        return (
          <div className="max-w-2xl mx-auto bg-gray-800 p-8 mt-10 rounded-xl shadow-lg">
            <h2 className="text-3xl font-bold text-center mb-8 text-white">
              사진 업로드
            </h2>
            <form onSubmit={handleSubmit}>
              <div className="mb-4">
                <label
                  htmlFor="title"
                  className="block text-gray-300 text-sm font-bold mb-2"
                >
                  제목
                </label>
                <input
                  type="text"
                  name="title"
                  id="title"
                  className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white dark-placeholder"
                  required
                />
              </div>
              <div className="mb-4">
                <label
                  htmlFor="tags"
                  className="block text-gray-300 text-sm font-bold mb-2"
                >
                  태그 (쉼표로 구분)
                </label>
                <input
                  type="text"
                  name="tags"
                  id="tags"
                  placeholder="예: 여행, 풍경, 고양이"
                  className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white dark-placeholder"
                />
              </div>
              <div className="mb-4">
                <label
                  htmlFor="description"
                  className="block text-gray-300 text-sm font-bold mb-2"
                >
                  상세 설명
                </label>
                <textarea
                  name="description"
                  id="description"
                  rows="4"
                  className="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white dark-placeholder"
                ></textarea>
              </div>
              <div className="mb-6">
                <label
                  htmlFor="photo"
                  className="block text-gray-300 text-sm font-bold mb-2"
                >
                  이미지 파일
                </label>
                <input
                  type="file"
                  name="photo"
                  id="photo"
                  className="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-500 file:text-white hover:file:bg-pink-600"
                  accept="image/*"
                  required
                />
              </div>
              <button
                type="submit"
                className="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg transition"
              >
                업로드
              </button>
            </form>
          </div>
        );
      };

      // React 앱 렌더링
      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
  </body>
</html>
